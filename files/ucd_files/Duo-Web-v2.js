!function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("object"==typeof module&&module.exports)module.exports=t();else{var n=t();n._onReady(n.init),e.Duo=n}}(this,function(){var i,r,s,o,a,u,m,t=/^(?:AUTH|ENROLL)+\|[A-Za-z0-9\+\/=]+\|[A-Za-z0-9\+\/=]+$/,n=/^ERR\|[\w\s\.\(\)]+$/,f=/^DUO_OPEN_WINDOW\|/,d=["duo.com","duosecurity.com","duomobile.s3-us-west-1.amazonaws.com"];function c(){i="",r="sig_response",m=u=a=o=s=void 0}function l(e,t){var n=t||"https://www.duosecurity.com/docs/duoweb#3.-show-the-iframe";throw new Error("Duo Web SDK error: "+e+(n?"\nSee "+n+" for more information":""))}function h(e,t){return"dataset"in e?e.dataset[t]:e.getAttribute("data-"+t.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase())}function g(e,t,n,o){"addEventListener"in window?e.addEventListener(t,o,!1):e.attachEvent(n,o)}function p(e,t,n,o){"removeEventListener"in window?e.removeEventListener(t,o,!1):e.detachEvent(n,o)}function v(e){g(document,"DOMContentLoaded","onreadystatechange",e)}function w(e){p(document,"DOMContentLoaded","onreadystatechange",e)}function _(e){if(e){0===e.indexOf("ERR|")&&l(e.split("|")[1]),-1!==e.indexOf(":")&&2===e.split(":").length||l("Duo was given a bad token.  This might indicate a configuration problem with one of Duo's client libraries.");var t=e.split(":");return o=t[0],a=t[1],{sigRequest:e,duoSig:t[0],appSig:t[1]}}}function b(e){return Boolean(e.origin==="https://"+s&&"string"==typeof e.data&&(e.data.match(t)||e.data.match(n)||e.data.match(f)))}function E(e){var t,n,o;return e.iframe&&e.iframeContainer?l("Passing both `iframe` and `iframeContainer` arguments at the same time is not allowed."):e.iframe?(t=y(e.iframe),(o=t)&&!C(o)&&l("`iframe` only accepts an iframe element or the id of an iframe. To use a non-iframe element, use the `iframeContainer` argument.")):e.iframeContainer?(t=y(e.iframeContainer),(n=t)&&C(n)&&l("`iframeContainer` only accepts a non-iframe element or the id of a non-iframe. To use a non-iframe element, use the `iframeContainer` argument on Duo.init().")):t=document.getElementById("duo_iframe"),t}function y(e){return e.tagName?e:"string"==typeof e?document.getElementById(e):null}function C(e){return e&&e.tagName&&"iframe"===e.tagName.toLowerCase()}function D(){return["https://",s,"/frame/web/v1/auth?tx=",o,"&parent=",encodeURIComponent(document.location.href),"&v=2.8"].join("")}function A(e){if(b(e))if(e.data.match(f)){var t=e.data.substring("DUO_OPEN_WINDOW|".length);!function(e){if(!e)return!1;var t=document.createElement("a");{if(t.href=e,"duotrustedendpoints:"===t.protocol)return!0;if("https:"!==t.protocol)return!1}for(var n=0;n<d.length;n++)if(t.hostname.endsWith("."+d[n])||t.hostname===d[n])return!0;return!1}(t)||window.open(t,"_self")}else R(e.data),p(window,"message","onmessage",A)}function O(e,t){if((s=s||h(e,"host"))||l("No API hostname is given for Duo to use.  Be sure to pass a `host` parameter to Duo.init, or through the `data-host` attribute on the iframe element."),o&&a||(_(h(e,"sigRequest")),o&&a||l("No valid signed request is given.  Be sure to give the `sig_request` parameter to Duo.init, or use the `data-sig-request` attribute on the iframe element.")),""===i&&(i=h(e,"postAction")||i),"sig_response"===r&&(r=h(e,"postArgument")||r),C(e))(u=e).src=D();else{for(;e.firstChild;)e.removeChild(e.firstChild);for(var n in u=document.createElement("iframe"),t.src=D(),t)u.setAttribute(n,t[n]);e.appendChild(u)}g(window,"message","onmessage",A)}function R(e){var t=document.createElement("input");t.type="hidden",t.name=r,t.value=e+":"+a;var n=document.getElementById("duo_form");n||(n=document.createElement("form"),u.parentElement.insertBefore(n,u.nextSibling)),n.method="POST",n.action=i,n.appendChild(t),"function"==typeof m?m.call(null,n):n.submit()}return c(),{init:function e(t){c(),t&&(t.host&&(s=t.host),t.sig_request&&_(t.sig_request),t.post_action&&(i=t.post_action),t.post_argument&&(r=t.post_argument),"function"==typeof t.submit_callback&&(m=t.submit_callback));var n,o,a=E(t);a?O(a,t.iframeAttributes||{}):(n=t,v(o=function(){var e=E(n);e||l('This page does not contain an iframe for Duo to use. Add an element like <iframe id="duo_iframe"></iframe> to this page.'),O(e,n.iframeAttributes||{}),w(o)})),w(e)},_onReady:v,_parseSigRequest:_,_isDuoMessage:b,_doPostBack:R}});
